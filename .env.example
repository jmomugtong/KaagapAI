# ============================================
# MedQuery Environment Configuration
# ============================================
# Copy this file to .env and update values
# NEVER commit .env to version control
# ============================================

# ============================================
# Application Settings
# ============================================
APP_NAME=MedQuery
APP_ENV=development
DEBUG=true
LOG_LEVEL=INFO

# ============================================
# API Configuration
# ============================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=1
API_V1_PREFIX=/api/v1

# ============================================
# Security & Authentication
# ============================================
# Generate with: openssl rand -hex 32
SECRET_KEY=change_this_to_a_secure_random_string_at_least_32_chars
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60
JWT_REFRESH_EXPIRATION_DAYS=7

# CORS Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# ============================================
# Database Configuration
# ============================================
# PostgreSQL with pgvector
DATABASE_URL=postgresql+asyncpg://medquery_user:change_this_password@postgres:5432/medquery
DB_HOST=postgres
DB_PORT=5432
DB_NAME=medquery
DB_USER=medquery_user
DB_PASSWORD=change_this_password

# Connection Pool
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30

# ============================================
# Redis Configuration
# ============================================
REDIS_URL=redis://redis:6379/0
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ============================================
# Celery Configuration
# ============================================
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# ============================================
# Ollama (Local LLM) Configuration
# ============================================
OLLAMA_URL=http://ollama:11434
OLLAMA_MODEL=phi3:mini
OLLAMA_TIMEOUT_SECONDS=30

# Model parameters
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=500
LLM_TOP_P=0.9
LLM_NUM_CTX=2048
LLM_NUM_THREAD=0
LLM_MAX_CONTEXT_CHUNKS=3
LLM_MAX_CHUNK_CHARS=300

# ============================================
# Embedding Configuration
# ============================================
EMBEDDING_MODEL=all-MiniLM-L6-v2
EMBEDDING_DIMENSION=384
EMBEDDING_BATCH_SIZE=32

# ============================================
# RAG Pipeline Configuration
# ============================================
# Chunking
CHUNK_SIZE=512
CHUNK_OVERLAP=100

# Retrieval
MAX_RETRIEVAL_RESULTS=10
BM25_WEIGHT=0.4
VECTOR_WEIGHT=0.6
FINAL_TOP_K=5

# Confidence thresholds
HIGH_CONFIDENCE_THRESHOLD=0.85
LOW_CONFIDENCE_THRESHOLD=0.70

# ============================================
# Caching Configuration
# ============================================
# TTL in seconds
EMBEDDING_CACHE_TTL_SECONDS=604800  # 7 days
QUERY_CACHE_TTL_SECONDS=3600         # 1 hour

# Cache settings
CACHE_MAX_SIZE_MB=500
CACHE_EVICTION_POLICY=lru

# ============================================
# Rate Limiting
# ============================================
RATE_LIMIT_PER_MINUTE=10
RATE_LIMIT_BURST=20

# ============================================
# File Storage
# ============================================
UPLOAD_DIR=/app/uploads
MAX_UPLOAD_SIZE_MB=50
ALLOWED_EXTENSIONS=pdf

# MinIO Configuration (Optional - for S3-compatible storage)
# MINIO_ENDPOINT=minio:9000
# MINIO_ACCESS_KEY=minioadmin
# MINIO_SECRET_KEY=minioadmin
# MINIO_BUCKET=medquery

# ============================================
# Monitoring & Observability
# ============================================
ENABLE_TELEMETRY=true
OTEL_SERVICE_NAME=medquery
OTEL_EXPORTER_TYPE=prometheus

# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change_this_password

# ============================================
# Evaluation Configuration
# ============================================
# Thresholds
ROUGE_L_THRESHOLD=0.60
HALLUCINATION_RATE_THRESHOLD=0.05
RETRIEVAL_RECALL_THRESHOLD=0.90
SEMANTIC_SIMILARITY_THRESHOLD=0.70

# Evaluation dataset
EVAL_DATASET_PATH=datasets/clinical_qa_50.json

# ============================================
# PII Redaction
# ============================================
ENABLE_PII_REDACTION=true
PII_LOG_ENCRYPTED=true

# ============================================
# Backup Configuration
# ============================================
BACKUP_DIR=/backups
BACKUP_RETENTION_DAYS=30
