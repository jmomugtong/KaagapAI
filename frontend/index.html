<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedQuery - Clinical RAG System</title>
    <link rel="stylesheet" href="styles.css?v=6" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>MedQuery</h1>
        <p class="subtitle">Classical vs. Agentic RAG for Clinical Documentation</p>
        <div class="status-bar" id="status-bar">
          <span class="status-dot"></span>
          <span id="status-text">Checking services...</span>
        </div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="classical">Classical</button>
        <button class="tab-btn" data-tab="agentic">Agentic</button>
        <button class="tab-btn tab-compare" data-tab="compare">Compare</button>
        <button class="tab-btn tab-upload" data-tab="upload">Upload</button>
      </div>

      <main>
        <!-- Query Form (shared across Classical, Agentic, Compare) -->
        <section id="query-form-section">
          <form id="query-form">
            <div class="form-group">
              <label for="question">Clinical Question</label>
              <textarea
                id="question"
                name="question"
                rows="3"
                placeholder="e.g., Compare pain protocols for knee vs hip replacement"
                required
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="max_results">Max Results</label>
                <input
                  type="number"
                  id="max_results"
                  name="max_results"
                  value="5"
                  min="1"
                  max="10"
                />
              </div>
              <div class="form-group">
                <label for="confidence_threshold">Confidence Threshold</label>
                <input
                  type="number"
                  id="confidence_threshold"
                  name="confidence_threshold"
                  value="0.7"
                  step="0.05"
                  min="0"
                  max="1"
                />
              </div>
            </div>

            <button type="submit" class="btn primary" id="query-btn">
              <span class="btn-text">Submit Query</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </form>
        </section>

        <!-- Classical Results -->
        <section id="classical" class="tab-content active">
          <div id="classical-results" class="results-area hidden"></div>
        </section>

        <!-- Agentic Results -->
        <section id="agentic" class="tab-content">
          <div id="agentic-results" class="results-area hidden"></div>
        </section>

        <!-- Compare Results -->
        <section id="compare" class="tab-content">
          <div id="compare-results" class="results-area hidden">
            <!-- Comparison summary bar -->
            <div class="comparison-summary" id="comparison-summary"></div>
            <!-- Side-by-side panels -->
            <div class="compare-panels">
              <div class="compare-panel classical-panel" id="compare-classical"></div>
              <div class="compare-panel agentic-panel" id="compare-agentic"></div>
            </div>
          </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="tab-content">
          <form id="upload-form">
            <div class="form-group">
              <label>Select Documents (PDF)</label>
              <div class="upload-mode-toggle">
                <button type="button" class="mode-btn active" data-mode="files">Select Files</button>
                <button type="button" class="mode-btn" data-mode="folder">Select Folder</button>
              </div>
              <div class="file-drop-zone" id="file-drop-zone">
                <input type="file" id="file-input-files" accept=".pdf" multiple class="file-input-hidden" />
                <input type="file" id="file-input-folder" accept=".pdf" webkitdirectory class="file-input-hidden hidden" />
                <div class="file-drop-text" id="file-drop-text">
                  <span class="file-icon">&#128196;</span>
                  <p id="drop-zone-label">Click to select or drag PDF files here</p>
                </div>
              </div>
              <div class="file-list hidden" id="file-list">
                <div class="file-list-header">
                  <span id="file-list-count">0 files selected</span>
                  <button type="button" class="btn-link" id="clear-files-btn">Clear all</button>
                </div>
                <div class="file-list-items" id="file-list-items"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="document_type">Document Type</label>
                <select id="document_type" name="document_type">
                  <option value="protocol">Protocol</option>
                  <option value="guideline">Guideline</option>
                  <option value="reference">Reference</option>
                </select>
              </div>
              <div class="form-group">
                <label for="department">Department</label>
                <input
                  type="text"
                  id="department"
                  name="department"
                  placeholder="e.g., Orthopedics"
                />
              </div>
            </div>

            <button type="submit" class="btn secondary" id="upload-btn">
              <span class="btn-text">Upload Documents</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </form>

          <!-- Batch Progress -->
          <div class="batch-progress hidden" id="batch-progress">
            <div class="batch-progress-header">
              <span id="batch-progress-label">Uploading 0 of 0...</span>
              <span id="batch-progress-pct">0%</span>
            </div>
            <div class="batch-progress-bar-container">
              <div class="batch-progress-bar" id="batch-progress-bar"></div>
            </div>
            <div class="file-list-items" id="batch-file-statuses"></div>
          </div>

          <!-- Batch Summary -->
          <div id="upload-results" class="results-area hidden">
            <div class="upload-success" id="upload-success">
              <div class="success-icon">&#10003;</div>
              <h3>Batch Upload Complete</h3>
              <div class="upload-details">
                <div class="detail-row">
                  <span class="detail-label">Files Uploaded</span>
                  <span class="detail-value" id="upload-file-count"></span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Total Chunks</span>
                  <span class="detail-value" id="upload-chunks"></span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Total Time</span>
                  <span class="detail-value" id="upload-time"></span>
                </div>
                <div class="detail-row hidden" id="upload-failures-row">
                  <span class="detail-label">Failed</span>
                  <span class="detail-value upload-failures-value" id="upload-failures"></span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <p>MedQuery v0.1.0 &middot; Zero-cost clinical RAG &middot; HIPAA-oriented</p>
      </footer>
    </div>

    <script src="app.js?v=6"></script>
  </body>
</html>
