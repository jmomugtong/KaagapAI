<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedQuery - Clinical RAG System</title>
    <link rel="stylesheet" href="styles.css?v=3" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>MedQuery</h1>
        <p class="subtitle">Production RAG System for Clinical Documentation</p>
        <div class="status-bar" id="status-bar">
          <span class="status-dot"></span>
          <span id="status-text">Checking services...</span>
        </div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="query">Query</button>
        <button class="tab-btn" data-tab="upload">Upload Document</button>
      </div>

      <main>
        <!-- Query Section -->
        <section id="query" class="tab-content active">
          <form id="query-form">
            <div class="form-group">
              <label for="question">Clinical Question</label>
              <textarea
                id="question"
                name="question"
                rows="3"
                placeholder="e.g., What is the post-operative pain protocol for knee replacement?"
                required
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="max_results">Max Results</label>
                <input
                  type="number"
                  id="max_results"
                  name="max_results"
                  value="5"
                  min="1"
                  max="10"
                />
              </div>
              <div class="form-group">
                <label for="confidence_threshold">Confidence Threshold</label>
                <input
                  type="number"
                  id="confidence_threshold"
                  name="confidence_threshold"
                  value="0.7"
                  step="0.05"
                  min="0"
                  max="1"
                />
              </div>
            </div>

            <button type="submit" class="btn primary" id="query-btn">
              <span class="btn-text">Submit Query</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </form>

          <div id="query-results" class="results-area hidden">
            <!-- Answer Section -->
            <div class="result-section" id="answer-section">
              <div class="result-header">
                <h3>Answer</h3>
                <div class="meta-pills">
                  <span class="pill" id="query-time-pill"></span>
                  <span class="pill" id="query-id-pill"></span>
                </div>
              </div>
              <div id="answer-text" class="answer-box"></div>
              <div id="hallucination-warning" class="warning-box hidden">
                Hallucination detected: some citations may reference sources not found in the retrieval set.
              </div>
            </div>

            <!-- Confidence Section -->
            <div class="result-section" id="confidence-section">
              <h3>Confidence</h3>
              <div class="confidence-bar-container">
                <div class="confidence-bar" id="confidence-bar">
                  <span id="confidence-label">0%</span>
                </div>
              </div>
              <span class="confidence-level" id="confidence-level"></span>
            </div>

            <!-- Citations Section -->
            <div class="result-section" id="citations-section">
              <h3>Citations <span class="count-badge" id="citations-count">0</span></h3>
              <div id="citations-list" class="citations-grid"></div>
            </div>

            <!-- Retrieved Chunks Section -->
            <div class="result-section" id="chunks-section">
              <h3>Retrieved Chunks <span class="count-badge" id="chunks-count">0</span></h3>
              <div id="chunks-list" class="chunks-list"></div>
            </div>

            <!-- Raw JSON Toggle -->
            <div class="result-section">
              <button class="btn-link" id="toggle-raw">Show Raw JSON</button>
              <div id="raw-json" class="json-output hidden"></div>
            </div>
          </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="tab-content">
          <form id="upload-form">
            <div class="form-group">
              <label for="file">Select Document (PDF)</label>
              <div class="file-drop-zone" id="file-drop-zone">
                <input type="file" id="file" name="file" accept=".pdf" required />
                <div class="file-drop-text">
                  <span class="file-icon">&#128196;</span>
                  <p>Click to select or drag a PDF file here</p>
                </div>
                <div class="file-selected hidden" id="file-selected">
                  <span class="file-icon">&#9989;</span>
                  <p id="file-name-display"></p>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="document_type">Document Type</label>
                <select id="document_type" name="document_type">
                  <option value="protocol">Protocol</option>
                  <option value="guideline">Guideline</option>
                  <option value="reference">Reference</option>
                </select>
              </div>
              <div class="form-group">
                <label for="department">Department</label>
                <input
                  type="text"
                  id="department"
                  name="department"
                  placeholder="e.g., Orthopedics"
                />
              </div>
            </div>

            <button type="submit" class="btn secondary" id="upload-btn">
              <span class="btn-text">Upload Document</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </form>

          <div id="upload-results" class="results-area hidden">
            <div class="upload-success" id="upload-success">
              <div class="success-icon">&#10003;</div>
              <h3>Document Uploaded Successfully</h3>
              <div class="upload-details">
                <div class="detail-row">
                  <span class="detail-label">Document ID</span>
                  <span class="detail-value" id="upload-doc-id"></span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Filename</span>
                  <span class="detail-value" id="upload-filename"></span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Chunks Created</span>
                  <span class="detail-value" id="upload-chunks"></span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Processing Time</span>
                  <span class="detail-value" id="upload-time"></span>
                </div>
              </div>
            </div>
            <div class="upload-error hidden" id="upload-error">
              <div class="error-icon">&#10007;</div>
              <h3>Upload Failed</h3>
              <p id="upload-error-msg"></p>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <p>MedQuery v0.1.0 &middot; Zero-cost clinical RAG &middot; HIPAA-oriented</p>
      </footer>
    </div>

    <script src="app.js?v=3"></script>
  </body>
</html>
