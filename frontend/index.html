<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedQuery — Clinical RAG System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              brand: { 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb' }
            }
          }
        }
      }
    </script>
    <style>
      /* Timeline connector lines */
      .timeline-item:not(:last-child)::after {
        content: '';
        position: absolute;
        left: 11px;
        top: 28px;
        width: 2px;
        bottom: -8px;
        background: #374151;
      }
      /* Scrollbar */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #111827; }
      ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
    </style>
  </head>
  <body class="bg-gray-950 text-gray-100 min-h-screen font-sans antialiased">

    <!-- Header -->
    <header class="border-b border-gray-800 bg-gray-900/80 backdrop-blur sticky top-0 z-10">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-xl font-bold text-white">MedQuery</span>
          <span class="text-xs text-gray-500 hidden sm:block">Clinical RAG · v0.1.0</span>
        </div>
        <div id="status-badge" class="flex items-center gap-2 text-sm">
          <span id="status-dot" class="w-2 h-2 rounded-full bg-gray-600 animate-pulse"></span>
          <span id="status-text" class="text-gray-400">Checking…</span>
        </div>
      </div>
    </header>

    <!-- Main layout -->
    <div class="max-w-6xl mx-auto px-4 py-6">

      <!-- Tab bar -->
      <nav class="flex gap-1 mb-6 border-b border-gray-800 pb-0">
        <button data-tab="query"   class="tab-btn px-4 py-2 text-sm font-medium rounded-t border-b-2 transition-colors">Query</button>
        <button data-tab="agentic" class="tab-btn px-4 py-2 text-sm font-medium rounded-t border-b-2 transition-colors">Agentic</button>
        <button data-tab="compare" class="tab-btn px-4 py-2 text-sm font-medium rounded-t border-b-2 transition-colors">Compare</button>
        <button data-tab="upload"  class="tab-btn px-4 py-2 text-sm font-medium rounded-t border-b-2 transition-colors">Upload</button>
        <button data-tab="monitor" class="tab-btn px-4 py-2 text-sm font-medium rounded-t border-b-2 transition-colors">Monitor</button>
      </nav>

      <!-- ======================================
           TAB: Query (Classical RAG)
      ====================================== -->
      <section id="tab-query" class="tab-pane hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Form -->
          <div class="lg:col-span-1">
            <div class="bg-gray-900 rounded-xl border border-gray-800 p-5">
              <h2 class="text-base font-semibold text-gray-200 mb-4">Classical RAG</h2>
              <form id="query-form" class="space-y-4">
                <div>
                  <label class="block text-xs text-gray-400 mb-1">Clinical Question</label>
                  <textarea id="q-question" rows="4" placeholder="What is the first-line treatment for hypertension?"
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-brand-500"></textarea>
                  <div class="flex flex-wrap gap-1.5 mt-2">
                    <span class="text-xs text-gray-500 w-full mb-0.5">Try:</span>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">First-line treatment for hypertension</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Warning signs of severe dengue</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Blood pressure targets for adults</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">TB treatment regimen for new patients</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Contraindications for metformin use</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Antibiotic choice for community-acquired pneumonia</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Post-exposure prophylaxis for rabies</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="q-question">Recommended vaccines for children under 5</button>
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs text-gray-400 mb-1">Max Results</label>
                    <input type="range" id="q-max" min="1" max="10" value="5" class="w-full accent-blue-500" oninput="document.getElementById('q-max-val').textContent=this.value" />
                    <span class="text-xs text-gray-500">n = <span id="q-max-val">5</span></span>
                  </div>
                  <div>
                    <label class="block text-xs text-gray-400 mb-1">Confidence Threshold</label>
                    <input type="range" id="q-conf" min="0" max="1" step="0.05" value="0.7" class="w-full accent-blue-500" oninput="document.getElementById('q-conf-val').textContent=parseFloat(this.value).toFixed(2)" />
                    <span class="text-xs text-gray-500"><span id="q-conf-val">0.70</span></span>
                  </div>
                </div>
                <button type="submit" id="q-btn"
                  class="w-full bg-brand-600 hover:bg-brand-500 disabled:opacity-50 text-white text-sm font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                  <span id="q-btn-text">Submit Query</span>
                  <svg id="q-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                  </svg>
                </button>
              </form>
            </div>
          </div>
          <!-- Result -->
          <div class="lg:col-span-2">
            <div id="query-result" class="hidden bg-gray-900 rounded-xl border border-gray-800 p-5 space-y-4"></div>
            <div id="query-placeholder" class="flex items-center justify-center h-48 text-gray-600 text-sm">
              Submit a query to see results
            </div>
          </div>
        </div>
      </section>

      <!-- ======================================
           TAB: Agentic RAG
      ====================================== -->
      <section id="tab-agentic" class="tab-pane hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Form -->
          <div class="lg:col-span-1">
            <div class="bg-gray-900 rounded-xl border border-gray-800 p-5">
              <h2 class="text-base font-semibold text-gray-200 mb-4">Agentic RAG</h2>
              <form id="agentic-form" class="space-y-4">
                <div>
                  <label class="block text-xs text-gray-400 mb-1">Clinical Question</label>
                  <textarea id="a-question" rows="4" placeholder="Compare hypertension vs diabetes first-line treatments"
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-brand-500"></textarea>
                  <div class="flex flex-wrap gap-1.5 mt-2">
                    <span class="text-xs text-gray-500 w-full mb-0.5">Try:</span>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">Warning signs of severe dengue and when to hospitalize</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">Compare adult vs pediatric pneumonia treatment guidelines</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">For a patient with diabetes and hypertension, what are the treatment considerations?</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">What is the complete immunization schedule for infants?</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">Compare WHO vs Philippine guidelines for malaria treatment</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">Acute stroke assessment and management within the first 24 hours</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">How does leptospirosis treatment differ between children and adults?</button>
                    <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="a-question">COVID-19 management for patients with mild vs severe symptoms</button>
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs text-gray-400 mb-1">Max Results</label>
                    <input type="range" id="a-max" min="1" max="10" value="5" class="w-full accent-blue-500" oninput="document.getElementById('a-max-val').textContent=this.value" />
                    <span class="text-xs text-gray-500">n = <span id="a-max-val">5</span></span>
                  </div>
                  <div>
                    <label class="block text-xs text-gray-400 mb-1">Confidence Threshold</label>
                    <input type="range" id="a-conf" min="0" max="1" step="0.05" value="0.7" class="w-full accent-blue-500" oninput="document.getElementById('a-conf-val').textContent=parseFloat(this.value).toFixed(2)" />
                    <span class="text-xs text-gray-500"><span id="a-conf-val">0.70</span></span>
                  </div>
                </div>
                <button type="submit" id="a-btn"
                  class="w-full bg-purple-700 hover:bg-purple-600 disabled:opacity-50 text-white text-sm font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                  <span id="a-btn-text">Submit Agentic Query</span>
                  <svg id="a-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                  </svg>
                </button>
              </form>
            </div>
          </div>
          <!-- Result -->
          <div class="lg:col-span-2 space-y-4">
            <div id="agentic-result" class="hidden bg-gray-900 rounded-xl border border-gray-800 p-5 space-y-4"></div>
            <div id="agentic-steps-panel" class="hidden bg-gray-900 rounded-xl border border-gray-800 p-5">
              <h3 class="text-sm font-semibold text-gray-300 mb-4">Reasoning Steps</h3>
              <div id="agentic-steps"></div>
            </div>
            <div id="agentic-placeholder" class="flex items-center justify-center h-48 text-gray-600 text-sm">
              Submit a query to see the reasoning trace
            </div>
          </div>
        </div>
      </section>

      <!-- ======================================
           TAB: Compare
      ====================================== -->
      <section id="tab-compare" class="tab-pane hidden">
        <div class="bg-gray-900 rounded-xl border border-gray-800 p-5 mb-6">
          <h2 class="text-base font-semibold text-gray-200 mb-4">Compare Classical vs Agentic</h2>
          <form id="compare-form" class="space-y-3">
            <div class="flex flex-col sm:flex-row gap-3">
              <textarea id="c-question" rows="2" placeholder="What are the contraindications for ACE inhibitors?"
                class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-brand-500"></textarea>
              <button type="submit" id="c-btn"
                class="sm:self-start bg-teal-700 hover:bg-teal-600 disabled:opacity-50 text-white text-sm font-medium px-5 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap">
                <span id="c-btn-text">Compare</span>
                <svg id="c-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                </svg>
              </button>
            </div>
            <div class="flex flex-wrap gap-1.5">
              <span class="text-xs text-gray-500 w-full mb-0.5">Try:</span>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">Fluid management for dengue shock syndrome</button>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">First-line antihypertensive medications</button>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">TB drug regimen and duration for new cases</button>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">Insulin initiation criteria for type 2 diabetes</button>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">Antimalarial drug choice for pregnant women</button>
              <button type="button" class="sample-q text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-gray-200 border border-gray-700 rounded-full px-2.5 py-1 transition-colors" data-target="c-question">Stroke thrombolysis eligibility and time window</button>
            </div>
          </form>
        </div>

        <!-- Metrics bar -->
        <div id="compare-metrics" class="hidden bg-gray-900 rounded-xl border border-gray-800 p-4 mb-6 grid grid-cols-2 sm:grid-cols-4 gap-4 text-center"></div>

        <!-- Side-by-side panels -->
        <div id="compare-panels" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-4">
          <div id="compare-classical" class="bg-gray-900 rounded-xl border border-blue-900 p-5 space-y-4">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-blue-500"></span>
              <span class="text-sm font-semibold text-blue-400">Classical RAG</span>
            </div>
          </div>
          <div id="compare-agentic" class="bg-gray-900 rounded-xl border border-purple-900 p-5 space-y-4">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-purple-500"></span>
              <span class="text-sm font-semibold text-purple-400">Agentic RAG</span>
            </div>
          </div>
        </div>
        <div id="compare-placeholder" class="flex items-center justify-center h-48 text-gray-600 text-sm">
          Submit a question to compare both pipelines
        </div>
      </section>

      <!-- ======================================
           TAB: Upload
      ====================================== -->
      <section id="tab-upload" class="tab-pane hidden">
        <div class="max-w-xl">
          <div class="bg-gray-900 rounded-xl border border-gray-800 p-5">
            <h2 class="text-base font-semibold text-gray-200 mb-4">Upload Clinical Document</h2>
            <form id="upload-form" class="space-y-4">
              <!-- Drop zone -->
              <div>
                <label class="block text-xs text-gray-400 mb-2">PDF File</label>
                <div id="drop-zone"
                  class="border-2 border-dashed border-gray-700 rounded-lg p-8 text-center cursor-pointer hover:border-gray-500 transition-colors">
                  <input type="file" id="file-input" accept=".pdf" multiple class="hidden" />
                  <svg class="w-8 h-8 text-gray-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                  <p id="drop-label" class="text-sm text-gray-500">Click or drag PDF files here</p>
                </div>
                <div id="file-list" class="hidden mt-2 space-y-1"></div>
              </div>

              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs text-gray-400 mb-1">Document Type</label>
                  <select id="upload-type"
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 focus:outline-none focus:ring-2 focus:ring-brand-500">
                    <option value="protocol">Protocol</option>
                    <option value="guideline">Guideline</option>
                    <option value="reference">Reference</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs text-gray-400 mb-1">Metadata (JSON)</label>
                  <input type="text" id="upload-meta" value="{}" placeholder='{"dept":"cardiology"}'
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 focus:outline-none focus:ring-2 focus:ring-brand-500" />
                </div>
              </div>

              <button type="submit" id="upload-btn"
                class="w-full bg-emerald-700 hover:bg-emerald-600 disabled:opacity-50 text-white text-sm font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                <span id="upload-btn-text">Upload</span>
                <svg id="upload-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
                </svg>
              </button>
            </form>

            <!-- Progress -->
            <div id="upload-progress" class="hidden mt-4 space-y-2">
              <div class="flex justify-between text-xs text-gray-400">
                <span id="progress-label">Uploading…</span>
                <span id="progress-pct">0%</span>
              </div>
              <div class="w-full bg-gray-800 rounded-full h-2">
                <div id="progress-bar" class="bg-emerald-500 h-2 rounded-full transition-all" style="width:0%"></div>
              </div>
              <div id="upload-file-statuses" class="space-y-1 mt-2"></div>
            </div>

            <!-- Summary -->
            <div id="upload-summary" class="hidden mt-4 bg-gray-800 rounded-lg p-4 text-sm space-y-1"></div>
          </div>
        </div>
      </section>

      <!-- ======================================
           TAB: Monitor
      ====================================== -->
      <section id="tab-monitor" class="tab-pane hidden">
        <div class="max-w-2xl">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-base font-semibold text-gray-200">Service Status</h2>
            <button id="refresh-btn"
              class="text-xs text-gray-400 hover:text-gray-200 border border-gray-700 px-3 py-1 rounded-lg transition-colors">
              Refresh
            </button>
          </div>
          <div id="service-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
          <p id="monitor-updated" class="text-xs text-gray-600 mt-4"></p>
        </div>
      </section>

    </div><!-- /max-w-6xl -->

    <!-- PDF Viewer Modal -->
    <div id="pdf-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="relative w-full max-w-4xl h-[85vh] mx-4 bg-gray-900 rounded-xl border border-gray-700 overflow-hidden flex flex-col">
        <div class="flex items-center justify-between px-4 py-2 border-b border-gray-800 bg-gray-900">
          <span id="pdf-modal-title" class="text-sm font-medium text-gray-200 truncate"></span>
          <button onclick="closePdfViewer()" class="text-gray-400 hover:text-white text-lg px-2">&times;</button>
        </div>
        <iframe id="pdf-modal-frame" class="flex-1 w-full bg-gray-800" src=""></iframe>
      </div>
    </div>

    <script src="app.js?v=8"></script>
  </body>
</html>
